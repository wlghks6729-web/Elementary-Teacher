<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>두 자리 ÷ 한 자리 챗봇형 튜터</title>
    <meta name="description" content="3학년을 위한 두 자리 ÷ 한 자리 나눗셈 챗봇형 학습 앱" />
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <!-- Tailwind CSS (CDN runtime) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 UMD + Babel Standalone for JSX in-browser -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body { min-height: 100vh; }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div class="max-w-5xl mx-auto px-4 py-8">
      <div class="mb-4 flex items-center justify-between">
        <h1 class="text-2xl md:text-3xl font-bold">두 자리 ÷ 한 자리 챗봇형 튜터</h1>
        <a href="README.html" class="text-sm underline">사용 안내</a>
      </div>
      <div id="app"></div>
      <footer class="mt-10 text-xs text-slate-500">
        © 2025 교실용 학습 튜터 • GitHub Pages/Netlify/Vercel로 자유 배포 가능
      </footer>
    </div>

    <script type="text/babel">
      const { useMemo, useState } = React;

      function makeProblem() {
        let divisor = Math.floor(Math.random() * 8) + 2; // 2~9
        let dividend = Math.floor(Math.random() * 90) + 10; // 10~99
        if (Math.random() < 0.3) {
          const q = Math.floor(Math.random() * 9) + 1; // 1~9
          dividend = divisor * (Math.floor(Math.random() * 9) + 1) + (Math.random() < 0.5 ? 0 : Math.floor(Math.random() * (divisor - 1)));
        }
        return { dividend, divisor };
      }

      function solve(dividend, divisor) {
        const tens = Math.floor(dividend / 10);
        const ones = dividend % 10;
        const tensEach = Math.floor(tens / divisor);
        const tensRem = tens % divisor;
        const onesTotal = ones + tensRem * 10;
        const onesEach = Math.floor(onesTotal / divisor);
        const onesRem = onesTotal % divisor;
        const quotient = tensEach * 10 + onesEach;
        const remainder = onesRem;
        return { tens, ones, tensEach, tensRem, onesTotal, onesEach, onesRem, quotient, remainder };
      }

      const Pill = ({ children }) => (
        <span className="inline-block rounded-full px-3 py-1 text-sm border shadow-sm bg-white">{children}</span>
      );

      const StepCard = ({ title, children, accent=false }) => (
        <div className={
          "rounded-2xl p-4 md:p-5 shadow border " +
          (accent ? "bg-blue-50 border-blue-200" : "bg-white border-slate-200")
        }>
          <div className="font-semibold mb-2 flex items-center gap-2">
            <div className="w-2 h-2 rounded-full bg-current" /> {title}
          </div>
          <div className="prose prose-sm max-w-none">{children}</div>
        </div>
      );

      const NumberInput = ({ value, onChange, placeholder }) => (
        <input
          inputMode="numeric"
          className="w-24 md:w-28 rounded-xl border px-3 py-2 text-center text-lg bg-white border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
          value={value}
          placeholder={placeholder}
          onChange={(e)=>onChange(e.target.value.replace(/[^0-9]/g, ""))}
        />
      );

      function LongDivisionBoard({ dividend, divisor, q1, q2, rem, showAnswer }) {
        const s = solve(dividend, divisor);
        const q1Show = showAnswer ? Math.floor(s.quotient / 10) : q1;
        const q2Show = showAnswer ? s.quotient % 10 : q2;
        const rShow = showAnswer ? s.remainder : rem;

        return (
          <div className="inline-block p-3 rounded-2xl border bg-white border-slate-300">
            <div className="flex items-start gap-2">
              <div className="pt-2 text-lg">{divisor}</div>
              <div className="relative">
                <div className="pl-3 pr-2 pb-2 border-l-2 border-b-2 border-slate-700 text-2xl tracking-widest font-semibold min-w-[5ch] text-center">
                  {dividend}
                </div>
                <div className="absolute -top-3 left-[3.2rem] md:left-[3.6rem] text-xl font-semibold">
                  <span>{q1Show ?? "_"}</span>
                  <span>{q2Show ?? "_"}</span>
                </div>
              </div>
            </div>
            <div className="text-right text-sm mt-1">
              나머지: <span className="font-semibold">{rShow ?? "_"}</span>
            </div>
          </div>
        );
      }

      function DivisionTutor() {
        const [{ dividend, divisor }, setProb] = useState(makeProblem());
        const s = useMemo(() => solve(dividend, divisor), [dividend, divisor]);

        const [tensEach, setTensEach] = useState("");
        const [onesEach, setOnesEach] = useState("");
        const [remainder, setRemainder] = useState("");
        const [showHints, setShowHints] = useState(false);
        const [teacherMode, setTeacherMode] = useState(false);

        const tensCorrect = tensEach !== "" && Number(tensEach) === s.tensEach;
        const onesCorrect = onesEach !== "" && Number(onesEach) === s.onesEach;
        const remCorrect = remainder !== "" && Number(remainder) === s.remainder;
        const allCorrect = tensCorrect && onesCorrect && remCorrect;

        function next() {
          const np = makeProblem();
          setProb(np);
          setTensEach(""); setOnesEach(""); setRemainder("");
          setShowHints(false);
        }

        return (
          <div className="grid gap-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <Pill>피제수: <b>{dividend}</b></Pill>
                <Pill>제수: <b>{divisor}</b></Pill>
                <Pill>문제 유형: 나머지 {s.remainder === 0 ? '없음' : '있음'}</Pill>
              </div>
              <label className="flex items-center gap-2 text-sm cursor-pointer select-none">
                <input type="checkbox" checked={teacherMode} onChange={(e)=>setTeacherMode(e.target.checked)} />
                교사용 풀이 표시
              </label>
            </div>

            <div className="flex flex-wrap items-center gap-4">
              <LongDivisionBoard
                dividend={dividend}
                divisor={divisor}
                q1={tensEach === "" ? undefined : Number(tensEach)}
                q2={onesEach === "" ? undefined : Number(onesEach)}
                rem={remainder === "" ? undefined : Number(remainder)}
                showAnswer={teacherMode}
              />
              <button className="rounded-2xl px-4 py-2 border shadow bg-white hover:bg-slate-50" onClick={next}>🔄 다음 문제</button>
              <button className="rounded-2xl px-4 py-2 border shadow bg-white hover:bg-slate-50" onClick={()=>setShowHints(v=>!v)}>
                💡 힌트 {showHints ? "숨기기" : "보기"}
              </button>
            </div>

            <StepCard title="1) 십모형 나누기: ‘십’은 몇 개씩 줄 수 있을까요?" accent>
              <p>
                {dividend}은(는) <b>{s.tens}십</b>과 <b>{s.ones}일</b>로 이루어져 있어요. {divisor}명에게 공평하게 나눠줄 때,
                <b> 십모형은 각자 몇 개씩</b> 줄 수 있을까요?
              </p>
              <div className="flex items-center gap-2 mt-2">
                <NumberInput value={tensEach} onChange={setTensEach} placeholder="?" />
                <span>개씩</span>
                {tensEach !== "" && (
                  <span className={tensCorrect ? "text-green-600" : "text-red-600"}>
                    {tensCorrect ? "정답!" : `다시 생각해보세요 (힌트: ${s.tens} ÷ ${divisor})`}
                  </span>
                )}
              </div>
              {showHints && (
                <div className="mt-2 text-sm text-slate-700">
                  힌트: {s.tens}을(를) {divisor}로 나누면, 각자 <b>{Math.floor(s.tens/divisor)}</b>십씩 갖고 <b>{s.tensRem}</b>십이 남아요.
                </div>
              )}
              {teacherMode && <div className="mt-2 text-sm opacity-80">정답: 각자 <b>{s.tensEach}</b>십씩, 남은 십모형 <b>{s.tensRem}</b>십</div>}
            </StepCard>

            <StepCard title="2) 남은 십모형을 일모형으로 바꾸기 (교과서 연결)">
              <p>
                남은 <b>{s.tensRem}십</b>은 <b>{s.tensRem * 10}일</b>로 바꿀 수 있어요. 그러면 처음에 있던 일 <b>{s.ones}일</b>과 합쳐서
                <b> {s.onesTotal}일</b>이 됩니다.
              </p>
              {teacherMode && <div className="text-sm opacity-80">연결: 표준 알고리즘의 ‘받아내림(내려쓰기)’과 의미가 같습니다.</div>}
            </StepCard>

            <StepCard title="3) 일모형 나누기: 이제 일은 몇 개씩 줄 수 있을까요?" accent>
              <div className="flex items-center gap-2">
                <span>{s.onesTotal} ÷ {divisor} =</span>
                <NumberInput value={onesEach} onChange={setOnesEach} placeholder="?" />
                <span>개씩</span>
                {onesEach !== "" && (
                  <span className={onesCorrect ? "text-green-600" : "text-red-600"}>
                    {onesCorrect ? "정답!" : `다시 시도해요 (힌트: ${s.onesTotal} ÷ ${divisor})`}
                  </span>
                )}
              </div>
              {showHints && (
                <div className="mt-2 text-sm text-slate-700">
                  힌트: {s.onesTotal}을(를) {divisor}로 나누면, 각자 <b>{Math.floor(s.onesTotal/divisor)}</b>개씩 갖고 <b>{s.onesRem}</b>개가 남아요.
                </div>
              )}
              {teacherMode && <div className="mt-2 text-sm opacity-80">정답: 각자 <b>{s.onesEach}</b>개, 남은 일모형 <b>{s.onesRem}</b>개</div>}
            </StepCard>

            <StepCard title="4) 몫과 나머지 정리하기 (표준 알고리즘)">
              <div className="flex flex-wrap items-center gap-3">
                <Pill>몫(십의 자리): <b>{tensEach === "" ? "_" : tensEach}</b></Pill>
                <Pill>몫(일의 자리): <b>{onesEach === "" ? "_" : onesEach}</b></Pill>
                <Pill>나머지: <NumberInput value={remainder} onChange={setRemainder} placeholder="?" /></Pill>
              </div>
              <div className="mt-3">
                <LongDivisionBoard
                  dividend={dividend}
                  divisor={divisor}
                  q1={tensEach === "" ? undefined : Number(tensEach)}
                  q2={onesEach === "" ? undefined : Number(onesEach)}
                  rem={remainder === "" ? undefined : Number(remainder)}
                  showAnswer={teacherMode}
                />
              </div>
              {remainder !== "" && (
                <div className={"mt-2 " + (remCorrect ? 'text-green-600' : 'text-red-600')}>
                  {remCorrect ? "정답이에요!" : `다시 생각해봐요 (힌트: 남은 일모형은 ${s.onesRem}개)`}
                </div>
              )}
              {teacherMode && <div className="mt-2 text-sm opacity-80">정답: 몫 <b>{s.quotient}</b>, 나머지 <b>{s.remainder}</b></div>}
            </StepCard>

            <div className="flex flex-wrap gap-2 items-center">
              <button onClick={next} className="rounded-2xl px-4 py-2 border shadow bg-white hover:bg-slate-50">🔁 새 문제 만들기</button>
              <button onClick={()=>{{
                /* 채우기 */
              }}} className="hidden"></button>
              <button onClick={()=>{
                /* 학습 상태 자동 채우기 */
                document.querySelectorAll('input').forEach(()=>{});
              }} className="hidden"></button>
              <button
                onClick={()=>{
                  const s2 = solve(dividend, divisor);
                  alert(`정답 확인\n- 몫: ${s2.quotient}\n- 나머지: ${s2.remainder}\n(교사용 모드에서 화면에도 표시돼요)`);
                }}
                className="rounded-2xl px-4 py-2 border shadow bg-white hover:bg-slate-50"
              >👀 정답 간단 확인</button>
              <button
                onClick={()=>{
                  const s2 = solve(dividend, divisor);
                  const text = [
                    `문제: ${dividend} ÷ ${divisor}`,
                    `풀이개요: 십모형 ${s2.tens} → 각자 ${s2.tensEach}십, ${s2.tensRem}십 남음 → 일로 바꾸어 ${s2.onesTotal}일`,
                    `일모형 나누기 결과: 각자 ${s2.onesEach}개, 남은 ${s2.onesRem}개`,
                    `정답: 몫 ${s2.quotient}, 나머지 ${s2.remainder}`
                  ].join("\n");
                  const blob = new Blob([text], {type: "text/plain;charset=utf-8"});
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement("a");
                  a.href = url; a.download = "division-result.txt";
                  a.click();
                  URL.revokeObjectURL(url);
                }}
                className="rounded-2xl px-4 py-2 border shadow bg-white hover:bg-slate-50"
              >📝 풀이 요약 저장(.txt)</button>
            </div>

            <StepCard title="활동 목표 & 교사 팁">
              <ul className="list-disc pl-5">
                <li>‘십모형→일모형’ 변환을 통해 표준 알고리즘의 의미를 연결합니다.</li>
                <li>오개념: 십모형 나눔에서 남은 십을 버리는 경우 → 반드시 일로 바꿔 합산하도록 유도합니다.</li>
                <li>심화: <em>몫이 한 자리</em>가 되는 경우(예: 18÷4)도 자연히 다루어집니다.</li>
                <li>평가: 결과 저장(.txt)으로 형성평가 기록을 남길 수 있습니다.</li>
              </ul>
            </StepCard>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('app'));
      root.render(<DivisionTutor />);
    </script>
  </body>
</html>